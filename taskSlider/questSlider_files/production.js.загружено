var headerHeight = $('.header').outerHeight();

$(window).on("resize", function () {
	var curWinHeight = $(this).height(),
		curWinWidth = $(this).width(),
		fullscreen = curWinHeight-headerHeight,
		sourceHeight = fullscreen*0.6,
		subpageHeight = fullscreen*0.4;
	
	if((curWinWidth > 1370 && curWinHeight > 750) || curWinHeight > 900) {
		$('.newsection').height(fullscreen);
		$('.sourcepage').height(sourceHeight);
		$('.subpage').height(subpageHeight-20);
	} else {
		$('.newsection').height(565);
		$('.sourcepage').height(fullscreen);
		$('.subpage').height(376-20);
	}
}).resize();

// left: 37, up: 38, right: 39, down: 40,
// spacebar: 32, pageup: 33, pagedown: 34, end: 35, home: 36
var keys = {37: 1, 38: 1, 39: 1, 40: 1};

function preventDefault(e) {
  //e = e || window.event;
  //if (e.preventDefault)
  //    e.preventDefault();
  //e.returnValue = false;  
}

function preventDefaultForScrollKeys(e) {
    //if (keys[e.keyCode]) {
    //    preventDefault(e);
    //    return false;
    //}
}

function disableScroll() {
  //if (window.addEventListener) // older FF
  //    window.addEventListener('DOMMouseScroll', preventDefault, false);
  //window.onwheel = preventDefault; // modern standard
  //window.onmousewheel = document.onmousewheel = preventDefault; // older browsers, IE
  //window.ontouchmove  = preventDefault; // mobile
  //document.onkeydown  = preventDefaultForScrollKeys;
}

function enableScroll() {
    //if (window.removeEventListener)
    //    window.removeEventListener('DOMMouseScroll', preventDefault, false);
    //window.onmousewheel = document.onmousewheel = null; 
    //window.onwheel = null; 
    //window.ontouchmove = null;  
    //document.onkeydown = null;  
}


(function($){
	//$("#page-wrapper").smoothWheel();
	$('.grid.news .item .inner .info').matchHeight({
		byRow: true,
	});

	$('.phonemask').mask('+7 (000) 000-00-00');

    $(window).on("load",function(){
        $(".projectlist").mCustomScrollbar();
    });
	
	$( ".btn.projects" ).click(function(e) {
		e.preventDefault();
		
		var $section = $(this).closest('.newsection'),
			overlay = $section.find('.projectoverlay'),
			projects = $section.find('.sectionprojects');
		
		if($(overlay).hasClass('active')) {
			$(overlay).removeClass('active');
			$(projects).removeClass('active');
			enableScroll();
		} else {
			$(overlay).addClass('active');
			$(projects).addClass('active');
			disableScroll();
		}
	});
	
	$( ".menutrigger" ).click(function(e) {
		e.preventDefault();
		
		if($(this).hasClass('active')) {
			$('.responsivemenu').removeClass('active');
		} else {
			$('.responsivemenu').addClass('active');
		}
	});
	$( ".closemenu" ).click(function(e) {
		$('.responsivemenu').removeClass('active');
	});
	
	$( ".closelist" ).click(function(e) {
		e.preventDefault();
		
		var projects = $(this).closest('.sectionprojects'),
			overlay = $('.projectoverlay');
		
		$(projects).removeClass('active');
		$(overlay).removeClass('active');
	});
	
	$( ".btn.order" ).click(function(e) {
		var title = $(this).data('title');
		
		var msg = "Я хочу заказать решение «"+title+"». Свяжитесь со мной по предоставленным контактам!";
		
		$('#orderit').find('textarea').val(msg);
	});
})(jQuery);

	
	$('.openpopup').magnificPopup({
		type:'inline',
		midClick: true, // allow opening popup on middle mouse click. Always set it to true if you don't provide alternative source.
  		removalDelay: 300,
		
  		// Class that is added to popup wrapper and background
  		// make it unique to apply your CSS animations just to this exact popup
  		mainClass: 'mfp-fade'
	});

$(document).click(function(event) {
	if ($(event.target).closest(".sectionprojects, .btn.projects").length) return;   //при клике на эти блоки не скрывать .display_settings_content
		$('.sectionprojects').removeClass('active');
		$('.projectoverlay').removeClass('active');
		enableScroll();
	event.stopPropagation();
});

$(window).scroll(function() {
    var scrollTop = $(window).scrollTop() + $(window).height(),
        $sections = $('.newsection'),
        //$indicator = $('.menu'),
        oVal = $(window).scrollTop() / 100;
    
    //$('.slide.main .build').css({'bottom':+(-oVal*50)+'px','top':-(-oVal*50)+'px'})
    
    $sections.each(function(){
        $section = $(this),
		$prevsection = $(this).prev(),
        //$link = $indicator.find('li').eq($section.index()-2);
        sectionTop = $(this).offset().top+200,
        sectionHeight = $(this).outerHeight(),
        beforeLength = $(this).height()/2,
        beforeScale = 0.2;
        beforeOpacity = 0.8;
        
        if(sectionTop > scrollTop) {
			$prevsection.find('.inner').css({'top':0+'px','transform':'scale(1)'});
			$prevsection.find('.soverlay').css('opacity','0');
        } else if(scrollTop >= sectionTop && sectionTop + sectionHeight + 100 > scrollTop) {
            var indHeight = beforeLength*(0+(scrollTop-sectionTop)/sectionHeight);
            var indScale = 1-beforeScale*(0+(scrollTop-sectionTop)/sectionHeight);
            var indOpacity = beforeOpacity*(0+(scrollTop-sectionTop)/sectionHeight);
			
			$prevsection.find('.inner').css({'top':indHeight+'px','transform':'scale('+indScale+')'});
			$prevsection.find('.soverlay').css('opacity',indOpacity);
        } else {
			$prevsection.find('.inner').css({'top':beforeLength+'px','transform':'scale(0.8)'});
			$prevsection.find('.soverlay').css('opacity','0.8');
        }
    });
});